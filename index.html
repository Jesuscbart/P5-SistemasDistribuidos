<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Socket.IO chat</title>
    <link rel="stylesheet" type="text/css" href="/styles.css" />
  </head>
  <body>
    <button class="button" onclick="showForm('login')">Login</button>
    <button class="button" onclick="showForm('register')">Sign Up</button>

    <form id="login-form">
      <input
        type="text"
        id="username"
        placeholder="Username"
        autocomplete="off"
        required
      />
      <input
        type="password"
        id="password"
        placeholder="Password"
        autocomplete="off"
        required
      />
      <button type="submit">Login</button>
    </form>

    <form id="register-form">
      <input
        type="text"
        id="register-username"
        placeholder="Username"
        autocomplete="off"
        required
      />
      <input
        type="password"
        id="register-password"
        placeholder="Password"
        autocomplete="off"
        required
      />
      <button type="submit">Register</button>
    </form>

    <ul id="messages"></ul>
    <form id="form" action="" style="display: none">
      <input id="input" placeholder="Enter message" autocomplete="off" /><button
        type="submit"
      >
        Send
      </button>
      <button type="button" id="close">Close Connection</button>
    </form>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const loginForm = document.getElementById("login-form");
      const registerForm = document.getElementById("register-form");
      const chatForm = document.getElementById("form");
      const input = document.getElementById("input");
      const messages = document.getElementById("messages");
      const loginButton = document.querySelector(
        "button[onclick=\"showForm('login')\"]",
      );
      const registerButton = document.querySelector(
        "button[onclick=\"showForm('register')\"]",
      );

      function showForm(type) {
        if (type === "login") {
          loginForm.style.display = "flex";
          registerForm.style.display = "none";
        } else if (type === "register") {
          registerForm.style.display = "flex";
          loginForm.style.display = "none";
        }
      }

      loginForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        socket.emit("login", { username, password });
      });

      registerForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const username = document.getElementById("register-username").value;
        const password = document.getElementById("register-password").value;
        socket.emit("register", { username, password });
      });

      socket.on("login success", function () {
        loginForm.style.display = "none";
        registerForm.style.display = "none";
        chatForm.style.display = "flex"; // Mostrar formulario de chat
        loginButton.style.display = "none"; // Ocultar bot贸n de login
        registerButton.style.display = "none"; // Ocultar bot贸n de registro
      });

      socket.on("login failed", function (message) {
        alert("Login failed: " + message);
      });

      socket.on("register success", function (message) {
        alert("Register successful: " + message);
        showForm("login"); // After successful registration, show the login form
      });

      socket.on("register failed", function (message) {
        alert("Register failed: " + message);
      });

      chatForm.addEventListener("submit", function (e) {
        e.preventDefault();
        if (input.value.trim() !== "") {
          socket.emit("chat message", input.value);
          input.value = "";
        }
      });

      socket.on("chat message", function (msg) {
        const item = document.createElement("li");
        item.textContent = msg;
        messages.appendChild(item);
        window.scrollTo(0, document.body.scrollHeight);
      });

      document.getElementById("close").addEventListener("click", function () {
        socket.disconnect();
        chatForm.style.display = "none"; // Ocultar formulario de chat
        input.disabled = true; // Desactivar entrada de mensaje
        loginButton.style.display = "block"; // Mostrar bot贸n de login
        registerButton.style.display = "block"; // Mostrar bot贸n de registro
        alert("You have been disconnected.");
      });
    </script>
  </body>
</html>
